<!--

    Copyright 2011-2018 Fraunhofer-Gesellschaft zur FÃ¶rderung der angewandten Wissenschaften e.V.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE html>
<html>
<head>
<script src="vis.js"></script>
<script src="jquery-1.11.1.min.js"></script>
<script src="communication.js"></script>

<title>Graph Generator GUI</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<link rel="stylesheet" href="vis.min.css" type="text/css">
<link rel="stylesheet" href="graph-generator.css" type="text/css">

<script type="text/javascript">
$(document).ready(function() {

	var resTypeCallback = function(data, status) {
		var list = "";
		var i;
		for (i=0;i<data.length;i++) {
			var tp = data[i];
			var idx = tp.lastIndexOf(".");
			if (idx <= 0) continue;
			var displayType = tp.substring(idx+1);
			list += "<option value=\"" + tp + "\">" + displayType + "</option>";
		}
		if (list.length === 0)
			list =  "<option value=\"org.ogema.core.model.Resource\">Resource</option>";
		var typeSelector = $('#resourceType');
		typeSelector.html(list);
	};
	sendGET(resTypeCallback);

	var generatorSelector = $('#generator');
	var buttonsJS = "<button id=\"writeAll\" onClick=\"writeAll()\">Show Resource tree</button>" + "<button id=\"writeConnections\" onClick=\"writeConnections()\">Show connections</button>"
		+ "<label for=\"phys_conf\"> <input type=\"checkbox\" id=\"phys_conf\"> Enable Physic Configurator </label> ";
	generatorSelector.change(function() {
		if($('#generator').val() === "graphviz") {
			var downloadButtons = "<form action=\"/apps/ogema/graphgenerator?user=" + otusr +"&pw=" + otpwd +"\" method=\"post\"> <input type=\"submit\" value=\"ALL\"/>"
					+ "<input type=\"hidden\" name=\"generator\" value=\"" + generatorSelector.val() + "\" /> "
					+ "<input type=\"hidden\" name=\"plottype\" value=\"all\" /></form>"
					+ "<form action=\"/apps/ogema/graphgenerator?user=" + otusr +"&pw=" + otpwd +"\" method=\"post\"> <input type=\"submit\" value=\"Connections\"/>"
					+ "<input type=\"hidden\" name=\"generator\" value=\"" + generatorSelector.val() + "\" /> "
                    + "<input type=\"hidden\" name=\"plottype\" value=\"connections\" /></form>";
			$('#buttonDiv').html(downloadButtons);
			// there is maybe still the phys conf div in the html because vis.js won't clean up:
			destroyVisJsContainer();
		} else {
			$('#buttonDiv').html(buttonsJS);
		}
	}).trigger('change');
	generatorSelector.val('visjs').change();
});
</script>

</head>
<body>
    <p>
        Select the mechanism you want to use to generate the graph. Visual JS will
        plot the graph directly within your browser while using Graphviz is generating
        a file that you can download and generate a pdf from this file (we recommend using
        dot for that -> 'dot -Tpdf -o&lt;output_filename&gt; resources.graph').
    </p>
    <select id="generator">
	    <option value="graphviz">Graphviz</option>
	    <option value="visjs">Visual JS</option>
    </select>
    <br>
    <p>
        Select the toplevel resource type.
    </p>
    <select id="resourceType">
    	<option value="org.ogema.core.model.Resource">Resource</option>
    </select>
    <br/>
    <p>
        Start.
    </p>
    <div id="buttonDiv"></div>
	<br/>
	<br/>
	<div id="resource_graph">
		<div tabindex="900"
			style="position: relative; overflow: hidden; -moz-user-select: none; width: 100%; height: 100%;"
			class="vis network-frame">
			<canvas height="500" width="800"
				style="position: relative; -moz-user-select: none; width: 100%; height: 100%;"></canvas>
		</div>
	</div>
</body>
</html>
